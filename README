# Veridat Hash Explorer

A public-facing blockchain explorer for the Veridat Hyperledger Fabric network. This REST API and web interface allows anyone to query and verify document hashes stored on the blockchain, providing transparency and immutability verification similar to block explorers like Pera for Algorand.

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Node.js Version](https://img.shields.io/badge/node-%3E%3D%2018.0.0-brightgreen)](https://nodejs.org/)
[![Hyperledger Fabric](https://img.shields.io/badge/Fabric-3.1.3-blue)](https://www.hyperledger.org/projects/fabric)

## üåü Features

- **Public REST API** - Query blockchain data via simple HTTP endpoints
- **Web Interface** - User-friendly browser interface for exploring hashes
- **Real-time Queries** - Direct queries to Hyperledger Fabric blockchain
- **Shareable Links** - Generate permanent links to specific hash records
- **Read-Only Access** - Secure, view-only access to blockchain data
- **CORS Enabled** - Easy integration with external applications

## üèóÔ∏è Architecture
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Web Browser   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Nginx (HTTPS)  ‚îÇ  ‚Üê Reverse Proxy + SSL
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Express API   ‚îÇ  ‚Üê Node.js REST API
‚îÇ   (Port 3000)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Fabric SDK     ‚îÇ  ‚Üê Connection Layer
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Hyperledger     ‚îÇ  ‚Üê Blockchain Network
‚îÇ Fabric Network  ‚îÇ
‚îÇ  - Peer (7056)  ‚îÇ
‚îÇ  - Channel      ‚îÇ
‚îÇ  - Chaincode    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üìã Prerequisites

### Required Software
- **Node.js** v18.0.0 or higher ([Download](https://nodejs.org/))
- **npm** (comes with Node.js)
- **Hyperledger Fabric** 3.1.3 network (already running)

### Network Requirements
- Running Hyperledger Fabric network with:
  - Channel: `paralite`
  - Chaincode: `hashcc` (deployed and committed)
  - Peer accessible at: `localhost:7056`

## üöÄ Quick Start

### 1. Clone the Repository
```bash
git clone https://github.com/yourusername/veridat-explorer-api.git
cd veridat-explorer-api
```

### 2. Install Dependencies
```bash
npm install
```

### 3. Configure the Application

Edit `config.json`:
```json
{
  "networkRoot": "../fabric-test-env/fabric-samples/veridat-network",
  "channelName": "paralite",
  "chaincodeName": "hashcc",
  "mspId": "VeridatMSP",
  "port": 3000
}
```

**Configuration Parameters:**

| Parameter | Description | Default |
|-----------|-------------|---------|
| `networkRoot` | Path to Fabric network directory | `../fabric-test-env/fabric-samples/veridat-network` |
| `channelName` | Fabric channel name | `paralite` |
| `chaincodeName` | Deployed chaincode name | `hashcc` |
| `mspId` | Organization MSP ID | `VeridatMSP` |
| `port` | API server port | `3000` |

### 4. Start the Server
```bash
node server.js
```

You should see:
```
==================================================
üöÄ Veridat Explorer API Server Started!
==================================================
üìç Web Interface:  http://localhost:3000
üìç API Endpoint:   http://localhost:3000/api/hashes
üìç Health Check:   http://localhost:3000/health
==================================================
```

### 5. Test the API
```bash
# Check health
curl http://localhost:3000/health

# Get all hashes
curl http://localhost:3000/api/hashes

# Get specific hash by document ID
curl http://localhost:3000/api/hash/DOC123
```

## üìö API Documentation

### Base URL
```
http://localhost:3000
```

### Endpoints

#### 1. Health Check
```http
GET /health
```

**Response:**
```json
{
  "status": "healthy",
  "timestamp": "2025-11-12T21:30:00.000Z",
  "network": "veridat",
  "channel": "paralite",
  "chaincode": "hashcc"
}
```

---

#### 2. Get All Hashes
```http
GET /api/hashes
```

**Response:**
```json
{
  "success": true,
  "count": 3,
  "data": [
    {
      "documentID": "DOC123",
      "hash": "a1b2c3d4e5f6...",
      "timestamp": "2025-11-12T10:30:00Z"
    },
    {
      "documentID": "DOC124",
      "hash": "f6e5d4c3b2a1...",
      "timestamp": "2025-11-12T11:45:00Z"
    }
  ],
  "timestamp": "2025-11-12T21:30:00.000Z"
}
```

---

#### 3. Get Hash by Document ID
```http
GET /api/hash/:documentId
```

**Parameters:**
- `documentId` (string) - The document identifier

**Example:**
```bash
curl http://localhost:3000/api/hash/DOC123
```

**Response:**
```json
{
  "success": true,
  "data": {
    "documentID": "DOC123",
    "hash": "a1b2c3d4e5f6...",
    "timestamp": "2025-11-12T10:30:00Z"
  },
  "shareLink": "http://localhost:3000/api/hash/DOC123"
}
```

**Error Response (404):**
```json
{
  "success": false,
  "message": "Document ID 'DOC123' not found"
}
```

---

#### 4. Search by Hash Value
```http
GET /api/search/:hashValue
```

**Parameters:**
- `hashValue` (string) - The full hash to search for

**Example:**
```bash
curl http://localhost:3000/api/search/a1b2c3d4e5f6...
```

**Response:**
```json
{
  "success": true,
  "data": {
    "documentID": "DOC123",
    "hash": "a1b2c3d4e5f6...",
    "timestamp": "2025-11-12T10:30:00Z"
  }
}
```

---

#### 5. API Documentation
```http
GET /api
```

**Response:**
```json
{
  "name": "Veridat Explorer API",
  "version": "1.0.0",
  "endpoints": {
    "GET /": "Web interface",
    "GET /health": "Health check",
    "GET /api": "API documentation",
    "GET /api/hashes": "Get all stored hashes",
    "GET /api/hash/:documentId": "Get hash by document ID",
    "GET /api/search/:hashValue": "Search by hash value"
  }
}
```

---

#### 6. Web Interface
```http
GET /
```

Opens the interactive web interface for browsing hashes.

---

## üåê Deployment

### Option 1: AWS Route 53 + Nginx (Production)

#### Prerequisites
- Domain managed in AWS Route 53 (e.g., `veridat.io`)
- Ubuntu server with public IP
- Ports 80 and 443 open

#### Steps

**1. Create DNS Record in Route 53:**
- Go to Route 53 ‚Üí Hosted zones ‚Üí your domain
- Create A record:
  - Name: `explorer`
  - Type: `A`
  - Value: Your server's public IP
  - TTL: 300

**2. Install Nginx and Certbot:**
```bash
sudo apt update
sudo apt install nginx certbot python3-certbot-nginx
```

**3. Configure Nginx:**
```bash
sudo nano /etc/nginx/sites-available/veridat-explorer
```
```nginx
server {
    listen 80;
    server_name explorer.veridat.io;

    # Rate limiting
    limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;
    limit_req zone=api_limit burst=20 nodelay;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        
        # CORS
        add_header Access-Control-Allow-Origin *;
    }
}
```

**4. Enable Site and Get SSL:**
```bash
sudo ln -s /etc/nginx/sites-available/veridat-explorer /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
sudo certbot --nginx -d explorer.veridat.io
sudo ufw allow 80
sudo ufw allow 443
```

**5. Create Systemd Service:**
```bash
sudo nano /etc/systemd/system/veridat-explorer.service
```
```ini
[Unit]
Description=Veridat Hash Explorer
After=network.target

[Service]
Type=simple
User=ubuntu
WorkingDirectory=/home/ubuntu/veridat-explorer-api
ExecStart=/usr/bin/node server.js
Restart=always
RestartSec=10
Environment=NODE_ENV=production

[Install]
WantedBy=multi-user.target
```
```bash
sudo systemctl daemon-reload
sudo systemctl enable veridat-explorer
sudo systemctl start veridat-explorer
```

**Access your explorer at:** `https://explorer.veridat.io` ‚úÖ

---

### Option 2: AWS EC2 Deployment

**Instance Requirements:**
- **Type:** t3.small (2 vCPU, 2 GB RAM) - $15/month
- **OS:** Ubuntu 22.04 LTS
- **Storage:** 20 GB SSD
- **Security Group:**
  - Port 22 (SSH)
  - Port 80 (HTTP)
  - Port 443 (HTTPS)

**Deploy Script:**
```bash
#!/bin/bash
# Run this on your EC2 instance

# Update system
sudo apt update && sudo apt upgrade -y

# Install Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# Install Nginx and Certbot
sudo apt install -y nginx certbot python3-certbot-nginx

# Clone repository
git clone https://github.com/yourusername/veridat-explorer-api.git
cd veridat-explorer-api

# Install dependencies
npm install

# Follow Nginx configuration steps above
```

---

### Option 3: Docker Deployment

**Dockerfile:**
```dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .

EXPOSE 3000

CMD ["node", "server.js"]
```

**docker-compose.yml:**
```yaml
version: '3.8'

services:
  veridat-explorer:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
    volumes:
      - ./config.json:/app/config.json
      - ./wallet:/app/wallet
      - ../fabric-test-env:/fabric-network:ro
    restart: unless-stopped
```

**Deploy:**
```bash
docker-compose up -d
```

---

## üîí Security Considerations

### Implemented Security Features

1. **Read-Only Access** - API only allows query operations, no writes
2. **Rate Limiting** - Prevents API abuse (10 requests/second)
3. **HTTPS/TLS** - Encrypted communication via Let's Encrypt
4. **Input Validation** - All inputs sanitized
5. **CORS Enabled** - Allows cross-origin requests for public API

### Additional Recommendations

1. **API Authentication** (Optional)
   
   Add API keys for premium features:
```javascript
   const apiKeyAuth = (req, res, next) => {
       const apiKey = req.headers['x-api-key'];
       if (apiKey === process.env.API_KEY) {
           next();
       } else {
           res.status(401).json({ error: 'Invalid API key' });
       }
   };
```

2. **Firewall Rules**
```bash
   sudo ufw default deny incoming
   sudo ufw default allow outgoing
   sudo ufw allow 22    # SSH
   sudo ufw allow 80    # HTTP
   sudo ufw allow 443   # HTTPS
   sudo ufw enable
```

3. **Monitoring & Logging**
```bash
   # View logs
   sudo journalctl -u veridat-explorer -f
   
   # Check service status
   sudo systemctl status veridat-explorer
```

4. **Regular Updates**
```bash
   # Update dependencies
   npm audit
   npm update
   
   # Update system
   sudo apt update && sudo apt upgrade
```

---

## üõ†Ô∏è Troubleshooting

### Common Issues

#### 1. "Cannot find module" Error
```bash
# Solution: Install dependencies
npm install
```

#### 2. "Certificate not found" Error

**Check certificate location:**
```bash
ls -la ~/workspace-3_projects/Crypto/PARANOID/fabric-test-env/fabric-samples/veridat-network/organizations/peerOrganizations/veridat.example.com/users/
```

**Ensure you have:**
- `Admin@veridat.example.com/`
- `User1@veridat.example.com/`

#### 3. "Query failed" Error

**Check Fabric network:**
```bash
docker ps | grep veridat
```

**Verify chaincode:**
```bash
docker exec peer0.veridat.example.com peer lifecycle chaincode querycommitted -C paralite
```

#### 4. Port 3000 Already in Use
```bash
# Find process using port 3000
sudo lsof -i :3000

# Kill the process
kill -9 <PID>

# Or use different port in config.json
```

#### 5. Cannot Connect to Peer

**Check peer is running:**
```bash
docker logs peer0.veridat.example.com --tail 50
```

**Verify port mapping:**
```bash
docker ps | grep peer0.veridat
# Should show: 0.0.0.0:7056->7051/tcp
```

#### 6. Wallet Identity Issues

**Reset wallet:**
```bash
rm -rf wallet
node server.js  # Will recreate identity
```

---

## üìä Performance & Scaling

### Current Capacity
- **Concurrent Users:** ~100-200
- **Requests/Second:** ~10 (with rate limiting)
- **Response Time:** <500ms average

### Scaling Options

1. **Horizontal Scaling:**
   - Deploy multiple instances behind load balancer
   - Use AWS ELB or Nginx load balancing

2. **Caching:**
   - Add Redis for frequently accessed hashes
   - Cache duration: 5-10 minutes

3. **Database Indexing:**
   - Add indexes to CouchDB for faster queries

4. **CDN:**
   - Use CloudFront for static assets
   - Cache API responses at edge locations

---

## üß™ Development

### Running in Development Mode
```bash
# Install nodemon for auto-restart
npm install -g nodemon

# Run with auto-restart
nodemon server.js
```

### Testing
```bash
# Test health endpoint
curl http://localhost:3000/health

# Test API endpoints
curl http://localhost:3000/api/hashes

# Load testing with Apache Bench
ab -n 1000 -c 10 http://localhost:3000/api/hashes
```

### Debugging

Enable debug logging:
```javascript
// In server.js, add at the top
process.env.DEBUG = 'fabric-network:*';
```

---

## üìÅ Project Structure
```
veridat-explorer-api/
‚îú‚îÄ‚îÄ server.js              # Main Express server
‚îú‚îÄ‚îÄ config.json            # Configuration file
‚îú‚îÄ‚îÄ package.json           # Node.js dependencies
‚îú‚îÄ‚îÄ package-lock.json      # Locked dependency versions
‚îú‚îÄ‚îÄ wallet/                # Fabric identity wallet (auto-generated)
‚îú‚îÄ‚îÄ README.md              # This file
‚îî‚îÄ‚îÄ .gitignore             # Git ignore rules
```

---

## ü§ù Contributing

Contributions are welcome! Please follow these steps:

1. Fork the repository
2. Create a feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

### Code Style

- Use ES6+ syntax
- Follow existing code formatting
- Add comments for complex logic
- Update README for new features

---

## üìù License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

---

## üôè Acknowledgments

- [Hyperledger Fabric](https://www.hyperledger.org/projects/fabric) - Enterprise blockchain platform
- [Express.js](https://expressjs.com/) - Web framework
- [Fabric SDK for Node.js](https://github.com/hyperledger/fabric-sdk-node) - Blockchain connectivity

---

## üìû Support

For issues and questions:

- **Issues:** [GitHub Issues](https://github.com/yourusername/veridat-explorer-api/issues)
- **Email:** support@veridat.io
- **Website:** [veridat.io](https://veridat.io)

---

## üó∫Ô∏è Roadmap

### Planned Features

- [ ] Advanced search with filters (date range, hash prefix)
- [ ] WebSocket support for real-time updates
- [ ] GraphQL API endpoint
- [ ] Pagination for large result sets
- [ ] Export functionality (CSV, JSON)
- [ ] Analytics dashboard
- [ ] Multi-channel support
- [ ] Transaction history view
- [ ] Block explorer functionality

---

## üìà Changelog

### Version 1.0.0 (2025-11-12)
- Initial release
- REST API with 6 endpoints
- Web interface for hash exploration
- Support for Hyperledger Fabric 3.1.3
- HTTPS/SSL support
- Rate limiting
- CORS enabled

---

**Built with ‚ù§Ô∏è using Hyperledger Fabric and Node.js**